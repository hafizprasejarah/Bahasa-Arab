<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz bab 3</title>
    <link rel="stylesheet" href="../style/style.css">
</head>

<body>
    <div class="main-card">
        <div class="glow-effect"></div>
        <h2 class="page-title">Ø§ÙÙ„Ù’Ø§ÙØ®Ù’ØªÙØ¨ÙØ§Ø±Ù - Ø§Ù„Ù’Ø£ÙØ¯ÙÙˆÙØ§ØªÙ Ù±Ù„Ù’Ù…ÙØ¯Ù’Ø±ÙØ³ÙÙŠÙÙ‘Ø©Ù</h2>
        <div class="arabic-text" style="font-size: 18px; color: #2563eb; margin-bottom: 30px; text-align: center;">
            Quiz - Alat-alat Sekolah
        </div>

        <!-- Perintah Belajar -->
        <div id="quiz-instruction"
            style="background: linear-gradient(135deg, #f97316, #ea580c); color: white; padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center; box-shadow: 0 10px 30px rgba(249, 115, 22, 0.3);">
            <div style="font-size: 20px; font-weight: 700; margin-bottom: 10px;">
                ğŸ¯ petunjuk pengerjaan
            </div>
            <div style="font-size: 16px; margin-bottom: 8px;" class="arabic-text">
                Ø§ÙØ®Ù’ØªÙØ±Ù Ø§Ù„Ù’Ø¥ÙØ¬ÙØ§Ø¨ÙØ©Ù Ø§Ù„ØµÙÙ‘Ø­ÙÙŠØ­ÙØ©Ù Ù…ÙÙ†Ù’ Ø¨ÙÙŠÙ’Ù†Ù Ø§Ù„Ù’Ø¥ÙjÙØ§Ø¨ÙØ§ØªÙ Ø§Ù„Ù’Ø¢ØªÙÙŠÙØ©Ù
            </div>
            <div style="font-size: 14px; opacity: 0.9;">
                Pilihlah jawaban yang benar di antara jawaban-jawaban berikut!
            </div>
        </div>

        <div id="quiz-container"
            style="background: rgba(255, 255, 255, 0.9); border: 2px solid rgba(234, 88, 12, 0.2); border-radius: 15px; padding: 30px; text-align: left; box-shadow: 0 8px 25px rgba(0,0,0,0.05); min-height: 300px;">
            <!-- Pertanyaan dan jawaban akan di-load oleh JS di sini -->
        </div>

        <!-- Kontainer Hasil (Awalnya disembunyikan) -->
        <div id="result-container"
            style="display: none; background: rgba(255, 255, 255, 0.9); border: 2px solid #10b981; border-radius: 15px; padding: 30px; text-align: center; box-shadow: 0 8px 25px rgba(0,0,0,0.05); margin-top: 20px;">
            <h3 style="font-size: 24px; font-weight: 700; color: #059669;">HASIL QUIZ</h3>
            <div id="score" style="font-size: 48px; font-weight: 700; color: #10b981; margin: 20px 0;"></div>
            <div id="score-text" style="font-size: 18px; color: #333; margin-bottom: 25px;"></div>
            <button class="btn btn-primary" onclick="restartQuiz()">
                <span>ğŸ”„</span> <span>Ulangi Quiz</span>
            </button>
        </div>

    </div>

    <!-- 
  =============================================================
  Data JSON Kuis (Bab 3)
  =============================================================
-->
    <script id="quiz-data" type="application/json">
{
    "questions": [
        {
            "questionNumber": 1,
            "question": "Ù…ÙØ§ Ø§Ø³Ù’Ù…Ù ØµÙØ¯ÙÙŠÙ‚Ù ÙÙØ§Ø±ÙÙˆÙ‚Ù ÙÙÙŠ Ø§Ù„Ù’Ø­ÙÙˆÙØ§Ø±ÙØŸ (Siapa nama teman Faruq dalam dialog?)",
            "answerOptions": [
                {"text": "Ù…ÙØ­Ù’Ù…ÙÙˆØ¯ÙŒ", "isCorrect": true},
                {"text": "Ù…ÙØ­Ù’Ø¨ÙÙˆØ¨ÙŒ"},
                {"text": "Ù…ÙØ­Ù’ÙÙÙˆØ¸ÙŒ"}
            ],
            "rationale": "Dialog Istima' akan menyebutkan nama teman-teman Faruq."
        },
        {
            "questionNumber": 2,
            "question": "Ù‡ÙÙ„Ù’ Ù…ÙØ³Ù’Ø·ÙØ±ÙØ©Ù Ù…ÙØ­Ù’ÙÙÙˆØ¸Ù Ø²ÙØ±Ù’Ù‚ÙØ§Ø¡ÙØŸ (Apakah penggaris Mahfuzh berwarna biru?)",
            "answerOptions": [
                {"text": "Ù†ÙØ¹ÙÙ…Ù’ (Ya)"},
                {"text": "Ù„ÙØ§ (Tidak)", "isCorrect": true}
            ],
            "rationale": "Dialog Istima' akan menjelaskan warna penggaris Mahfuzh."
        },
        {
            "questionNumber": 3,
            "question": "Ù…ÙØ§ Ù„ÙÙˆÙ’Ù†Ù Ù‚ÙÙ„ÙÙ…Ù ÙÙØ§Ø±ÙÙˆÙ‚ÙØŸ (Apa warna pena Faruq?)",
            "answerOptions": [
                {"text": "Ø£ÙØ®Ù’Ø¶ÙØ±Ù (Hijau)"},
                {"text": "Ø£ÙØ­Ù’Ù…ÙØ±Ù (Merah)"},
                {"text": "Ø£ÙØ²Ù’Ø±ÙÙ‚Ù (Biru)", "isCorrect": true}
            ],
            "rationale": "Dialog Istima' akan menyebutkan warna pena milik Faruq."
        },
        {
            "questionNumber": 4,
            "question": "Ù„ÙÙ…ÙÙ†Ù’ Ø°ÙÙ„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ø§Ù„Ù’ÙƒÙØ¨ÙÙŠØ±ÙØŸ (Milik siapa buku besar itu?)",
            "answerOptions": [
                {"text": "Ù„ÙÙÙØ§Ø±ÙÙˆÙ‚Ù (Milik Faruq)"},
                {"text": "Ù„ÙØ¹ÙØ§Ø¦ÙØ´ÙØ©Ù (Milik Aisyah)", "isCorrect": true},
                {"text": "Ù„ÙÙ„Ù’Ø£ÙØ³Ù’ØªÙØ§Ø°Ù (Milik Guru)"}
            ],
            "rationale": "Dialog Istima' akan menyebutkan nama pemilik buku besar."
        },
        {
            "questionNumber": 5,
            "question": "Ù…ÙØ§ Ù„ÙÙˆÙ’Ù†Ù ÙƒÙØªÙØ§Ø¨Ù Ø¹ÙØ§Ø¦ÙØ´ÙØ©ÙØŸ (Apa warna buku Aisyah?)",
            "answerOptions": [
                {"text": "Ø£ÙØ­Ù’Ù…ÙØ±Ù (Merah)", "isCorrect": true},
                {"text": "Ø£ÙØµÙ’ÙÙØ±Ù (Kuning)"},
                {"text": "Ø£ÙØ³Ù’ÙˆÙØ¯Ù (Hitam)"}
            ],
            "rationale": "Dialog Istima' akan menyebutkan warna buku Aisyah."
        },
        {
            "questionNumber": 6,
            "question": "Ù…ÙÙ†Ù’ Ù‡ÙÙŠÙ Ø§Ù„Ù’Ø¨ÙÙ†Ù’ØªÙ Ø§Ù„Ù’Ø£ÙØ®Ù’Ø±ÙÙ‰ ÙÙÙŠ Ø§Ù„Ù’Ø­ÙÙˆÙØ§Ø±ÙØŸ (Siapa gadis lain dalam dialog?)",
            "answerOptions": [
                {"text": "ÙÙØ§Ø·ÙÙ…ÙØ©Ù"},
                {"text": "Ø®ÙØ¯ÙÙŠØ¬ÙØ©Ù"},
                {"text": "Ù…ÙØ±Ù’ÙÙÙˆØ¹ÙØ©Ù", "isCorrect": true}
            ],
            "rationale": "Dialog Istima' akan menyebutkan nama gadis lain selain Aisyah."
        },
        {
            "questionNumber": 7,
            "question": "Ù…ÙØ§ Ù„ÙÙˆÙ’Ù†Ù Ù…ÙÙ…Ù’Ø³ÙØ­ÙØ©Ù Ø§Ù„Ù’Ø£ÙØ³Ù’ØªÙØ§Ø°ÙØŸ (Apa warna penghapus Pak Guru?)",
            "answerOptions": [
                {"text": "Ø³ÙÙˆÙ’Ø¯ÙØ§Ø¡Ù (Hitam)"},
                {"text": "Ø¨ÙÙŠÙ’Ø¶ÙØ§Ø¡Ù (Putih)", "isCorrect": true},
                {"text": "Ø²ÙØ±Ù’Ù‚ÙØ§Ø¡Ù (Biru)"}
            ],
            "rationale": "Dialog Istima' akan menyebutkan warna penghapus milik guru."
        },
        {
            "questionNumber": 8,
            "question": "Klasifikasi: Ù‚ÙÙ„ÙÙ…ÙÙŠ Ø£ÙØ®Ù’Ø¶ÙØ±Ù",
            "answerOptions": [
                {"text": "Mudzakkar (M)", "isCorrect": true},
                {"text": "Muannats (Mh)"}
            ],
            "rationale": "Ù‚ÙÙ„ÙÙ…ÙŒ (Mudzakar) menggunakan warna Ø£ÙØ®Ù’Ø¶ÙØ±Ù (Mudzakar)."
        },
        {
            "questionNumber": 9,
            "question": "Klasifikasi: Ù…ÙØ³Ù’Ø·ÙØ±ÙØªÙÙŠ Ø²ÙØ±Ù’Ù‚ÙØ§Ø¡Ù",
            "answerOptions": [
                {"text": "Mudzakkar (M)"},
                {"text": "Muannats (Mh)", "isCorrect": true}
            ],
            "rationale": "Ù…ÙØ³Ù’Ø·ÙØ±ÙØ©ÙŒ (Muannats) menggunakan warna Ø²ÙØ±Ù’Ù‚ÙØ§Ø¡Ù (Muannats)."
        },
        {
            "questionNumber": 10,
            "question": "Klasifikasi: ÙƒÙØªÙØ§Ø¨ÙÙ‡ÙØ§ Ø£ÙØ­Ù’Ù…ÙØ±Ù",
            "answerOptions": [
                {"text": "Mudzakkar (M)", "isCorrect": true},
                {"text": "Muannats (Mh)"}
            ],
            "rationale": "ÙƒÙØªÙØ§Ø¨ÙŒ (Mudzakar) menggunakan warna Ø£ÙØ­Ù’Ù…ÙØ±Ù (Mudzakar)."
        },
        {
            "questionNumber": 11,
            "question": "Klasifikasi: Ù…ÙÙ…Ù’Ø³ÙØ­ÙØ©Ù Ø§Ù„Ù’Ø£ÙØ³Ù’ØªÙØ§Ø°Ù Ø¨ÙÙŠÙ’Ø¶ÙØ§Ø¡Ù",
            "answerOptions": [
                {"text": "Mudzakkar (M)"},
                {"text": "Muannats (Mh)", "isCorrect": true}
            ],
            "rationale": "Ù…ÙÙ…Ù’Ø³ÙØ­ÙØ©ÙŒ (Muannats) menggunakan warna Ø¨ÙÙŠÙ’Ø¶ÙØ§Ø¡Ù (Muannats)."
        }
    ]
}
</script>

    <!-- 
  =============================================================
  JavaScript untuk Menjalankan Kuis (SAMA SEPERTI BAB 1 & 2)
  =============================================================
-->
    <script>
        (function () {
            // Cek dulu, jangan sampe script-nya jalan dua kali kalo user bolak-balik
            if (window.quizScriptLoaded) {
                window.quizScriptLoaded = false;
            }

            let hasQuizScriptRun = false;

            if (document.getElementById('quiz-container') && !hasQuizScriptRun) {
                hasQuizScriptRun = true;
                window.quizScriptLoaded = true; // Tandai kalo script udah jalan

                let currentQuestionIndex = 0;
                let score = 0;
                let questions = [];

                const quizContainer = document.getElementById('quiz-container');
                const resultContainer = document.getElementById('result-container');
                const scoreElement = document.getElementById('score');
                const scoreTextElement = document.getElementById('score-text');
                const instructionBox = document.getElementById('quiz-instruction');

                function loadQuiz() {
                    try {
                        const quizDataElement = document.getElementById('quiz-data');
                        if (!quizDataElement) {
                            console.error('Quiz data element not found!');
                            quizContainer.innerHTML = '<p>Error: Gagal memuat data kuis.</p>';
                            return;
                        }
                        const quizData = JSON.parse(quizDataElement.textContent);
                        if (!quizData || !quizData.questions) {
                            throw new Error('Invalid quiz data structure');
                        }
                        questions = quizData.questions;
                        startQuiz();
                    } catch (error) {
                        console.error('Failed to load or parse quiz data:', error);
                        quizContainer.innerHTML = `<p>Error: Gagal memuat kuis. ${error.message}</p>`;
                    }
                }

                function startQuiz() {
                    currentQuestionIndex = 0;
                    score = 0;
                    resultContainer.style.display = 'none';
                    instructionBox.style.display = 'block';
                    quizContainer.style.display = 'block';
                    showQuestion(questions[currentQuestionIndex]);
                }

                function showQuestion(question) {
                    if (!question) {
                        showResults();
                        return;
                    }

                    const mainCard = quizContainer.closest('.main-card');
                    if (mainCard) {
                        mainCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }

                    let optionsHtml = '';
                    question.answerOptions.forEach((option, index) => {
                        optionsHtml += `
                        <button 
                            class="btn quiz-option" 
                            style="background: #f1f5f9; color: #333; width: 100%; justify-content: flex-start; text-align: left; margin-bottom: 10px; padding: 15px 20px;"
                            onclick="selectAnswer(this, ${option.isCorrect || false}, '${btoa(encodeURIComponent(question.rationale))}')"
                        >
                            <span class="arabic-text">${option.text}</span>
                        </button>
                    `;
                    });

                    quizContainer.innerHTML = `
                    <h3 class="arabic-text" style="font-size: 20px; font-weight: 700; color: #ea580c; margin-bottom: 15px;">
                        Ø§Ù„Ø³ÙÙ‘Ø¤ÙØ§Ù„Ù ${question.questionNumber}:
                    </h3>
                    <p style="font-size: 18px; line-height: 1.8; color: #333; margin-bottom: 20px; font-weight: 600;" class="${isArabic(question.question) ? 'arabic-text' : ''}">
                        ${question.question}
                    </p>
                    <div id="options-container">
                        ${optionsHtml}
                    </div>
                    <div id="rationale-container" style="display: none; margin-top: 15px; padding: 15px; border-radius: 10px; font-size: 14px;"></div>
                    <button 
                        id="next-btn" 
                        class="btn btn-secondary" 
                        style="display: none; margin-top: 20px; width: 100%;"
                        onclick="nextQuestion()"
                    >
                        Lanjut <span>&rarr;</span>
                    </button>
                `;
                }

                function isArabic(text) {
                    const arabicRegex = /[\u0600-\u06FF]/;
                    return arabicRegex.test(text);
                }

                window.selectAnswer = function (button, isCorrect, encodedRationale) {
                    const optionsContainer = document.getElementById('options-container');
                    const rationaleContainer = document.getElementById('rationale-container');
                    const nextBtn = document.getElementById('next-btn');

                    const allOptions = optionsContainer.querySelectorAll('.quiz-option');
                    allOptions.forEach(btn => {
                        btn.disabled = true;
                        btn.style.cursor = 'not-allowed';
                        btn.style.opacity = '0.7';
                    });

                    try {
                        const rationale = decodeURIComponent(atob(encodedRationale));
                        rationaleContainer.innerHTML = `<strong>Penjelasan:</strong> ${rationale}`;
                        rationaleContainer.style.display = 'block';
                    } catch (e) {
                        console.error("Error decoding rationale:", e);
                        rationaleContainer.innerHTML = '<strong>Penjelasan:</strong> Gagal memuat penjelasan.';
                        rationaleContainer.style.display = 'block';
                    }

                    if (isCorrect) {
                        score++;
                        button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                        button.style.color = 'white';
                        button.style.opacity = '1';
                        rationaleContainer.style.background = 'rgba(16, 185, 129, 0.1)';
                        rationaleContainer.style.border = '2px solid #10b981';
                    } else {
                        button.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                        button.style.color = 'white';
                        button.style.opacity = '1';
                        rationaleContainer.style.background = 'rgba(239, 68, 68, 0.1)';
                        rationaleContainer.style.border = '2px solid #ef4444';

                        allOptions.forEach(btn => {
                            const optionText = btn.querySelector('.arabic-text').textContent;
                            const correctOption = questions[currentQuestionIndex].answerOptions.find(opt => opt.isCorrect);
                            if (correctOption && correctOption.text === optionText) {
                                btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                                btn.style.color = 'white';
                                btn.style.opacity = '1';
                            }
                        });
                    }

                    nextBtn.style.display = 'inline-flex';
                }

                window.nextQuestion = function () {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < questions.length) {
                        showQuestion(questions[currentQuestionIndex]);
                    } else {
                        showResults();
                    }
                }

                function showResults() {
                    quizContainer.style.display = 'none';
                    instructionBox.style.display = 'none';
                    resultContainer.style.display = 'block';

                    const percentage = Math.round((score / questions.length) * 100);
                    scoreElement.textContent = `${percentage}%`;

                    let text = '';
                    if (percentage === 100) {
                        text = `Mumtaz! (Luar Biasa!) Kamu menjawab semua ${questions.length} soal dengan benar.`;
                        scoreElement.style.color = '#10b981';
                    } else if (percentage >= 80) {
                        text = `Jayyid Jiddan! (Bagus Sekali!) Kamu benar ${score} dari ${questions.length} soal.`;
                        scoreElement.style.color = '#10b981';
                    } else if (percentage >= 60) {
                        text = `Jayyid! (Bagus) Kamu benar ${score} dari ${questions.length} soal. Terus berlatih!`;
                        scoreElement.style.color = '#f59e0b';
                    } else {
                        text = `Butuh latihan lagi. Kamu benar ${score} dari ${questions.length} soal. Coba lagi!`;
                        scoreElement.style.color = '#ef4444';
                    }
                    scoreTextElement.textContent = text;

                    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }

                window.restartQuiz = function () {
                    window.quizScriptLoaded = false;
                    hasQuizScriptRun = false;
                    loadQuiz();
                }

                loadQuiz();
            }
        })();
    </script>
</body>

</html>